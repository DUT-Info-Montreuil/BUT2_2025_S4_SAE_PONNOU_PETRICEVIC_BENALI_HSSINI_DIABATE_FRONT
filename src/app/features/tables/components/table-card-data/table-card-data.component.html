<div class="relative p-2">
<!-- Bouton d'ajout -->
<button 
  (click)="startAdding()"
  class="bg-blue-500 text-white px-3 py-1 rounded-md text-sm hover:bg-blue-600 transition-colors flex items-center gap-1 mb-4"
>
  <span>+</span> Ajouter un élément
</button>

<!-- Formulaire d'ajout -->
@if (isAddingMode) {
  <div class="bg-gray-100 rounded-md p-4 mb-4 shadow-md">
    <h3 class="text-lg font-medium mb-3">Nouvel élément</h3>
    
    @if (errorMessage) {
      <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
        {{ errorMessage }}
      </div>
    }

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
      @if (filteredData && filteredData.length > 0) {
        @for (key of getObjectKeys(filteredData[0]); track $index) {
          <div>
            <label class="block text-sm font-medium mb-1">
              {{ key }}
              @if (requiredFields.includes(key)) {
                <span class="text-red-500">*</span>
              }
            </label>
            
            @if (key.includes('date')) {
              <input type="date"
                     [(ngModel)]="newItem[key]"
                     class="w-full border rounded-md p-2 text-sm"
                     [required]="requiredFields.includes(key)">
            } @else if (key === 'typeAbonnement') {
              <select [(ngModel)]="newItem[key]"
                      class="w-full border rounded-md p-2 text-sm"
                      [required]="requiredFields.includes(key)">
                <option value="">Sélectionner...</option>
                <option value="Basic">Basic</option>
                <option value="Standard">Standard</option>
                <option value="Premium">Premium</option>
              </select>
            } @else if (key === 'categorieAge') {
              <select [(ngModel)]="newItem[key]"
                      class="w-full border rounded-md p-2 text-sm"
                      [required]="requiredFields.includes(key)">
                <option value="">Sélectionner...</option>
                <option value="Tout public">Tout public</option>
                <option value="12+">12+</option>
                <option value="16+">16+</option>
                <option value="18+">18+</option>
              </select>
            } @else {
              <input type="{{ key === 'email' ? 'email' : 'text' }}"
                     [(ngModel)]="newItem[key]"
                     class="w-full border rounded-md p-2 text-sm"
                     [required]="requiredFields.includes(key)">
            }
          </div>
        }
      }
    </div>

    <div class="flex justify-end gap-2">
      <button (click)="cancelAdding()"
              class="bg-gray-500 text-white px-4 py-2 rounded text-sm">
        Annuler
      </button>
      <button (click)="saveNewItem()"
              class="bg-green-500 text-white px-4 py-2 rounded text-sm">
        Enregistrer
      </button>
    </div>
  </div>
}

  <button
    (click)="toggleFilters()"
    class="bg-gray-100 text-gray-700 px-3 py-1 rounded-md text-sm hover:bg-gray-200 transition-colors"
  >
    Filtre
  </button>

  @if (showFilters) {
  <div class="absolute mt-1 bg-white border border-gray-200 rounded-md shadow-md w-48 z-10">
    <form [formGroup]="filterForm" (ngSubmit)="onSubmit()">
      @for (filter of availableFilters; track filter.key) {
      <div class="block w-full text-left px-4 py-2 hover:bg-gray-100 text-sm text-gray-700">
        <label>{{ filter.name }}</label>
        <input
          type="text"
          [formControlName]="filter.key"
          placeholder="Entrez une valeur"
          class="w-full border rounded-md p-1 mt-1"
        />
        <label class="flex items-center mt-1">
          <input
            type="checkbox"
            [formControlName]="filter.key + '_isGreaterThan'"
            class="mr-2"
          />
          Supérieur à
        </label>
      </div>
      }
      <button type="submit" class="hidden">Submit</button>
    </form>
  </div>
  }
</div>

<div class="p-2">
  @if (filteredData) {
    @if (filteredData.length > 0) {
    <div class="bg-gray-100 rounded-md p-2 mb-2">
      <div class="grid grid-cols-[repeat(auto-fit,minmax(100px,1fr))] gap-2 text-sm font-medium border-b py-1">
        @for (key of getObjectKeys(filteredData[0]); track $index) {
        <span class="cursor-pointer hover:text-blue-500" (click)="onSort(key)">
          {{ key }}
          @for (sortKey of sortKeys; track $index) { @if (sortKey.key === key) {
          <span>{{ sortKey.direction === "asc" ? "▲" : "▼" }}</span>
          } }
        </span>
        }
        <span>Actions</span>
      </div>

      @for (item of filteredData; track $index) {
        <div class="grid grid-cols-[repeat(auto-fit,minmax(100px,1fr))] gap-2 text-sm border-b last:border-none py-1">
          @for (key of getObjectKeys(item); track $index) {
            <span>
              @if (editingItem === item) {
                <input type="text"
                       [(ngModel)]="tempItem[key]"
                       class="border p-1 w-full text-sm">
              } @else {
                {{ getValue(key, item) }}
              }
            </span>
          }
          <div class="relative flex gap-2">
            @if (editingItem === item) {
              <button (click)="saveChanges()"
                      class="bg-green-500 text-white px-2 py-1 rounded text-sm">
                Valider
              </button>
              <button (click)="cancelEditing()"
                      class="bg-gray-500 text-white px-2 py-1 rounded text-sm">
                Annuler
              </button>
            } @else {
              <button
                (click)="toggleActionMenu($index)"
                class="bg-gray-100 text-gray-700 px-3 py-1 rounded-md text-sm hover:bg-gray-200 transition-colors"
              >
                ⋮
              </button>
              @if (actionMenuOpen === $index) {
                <div class="absolute right-0 mt-1 bg-white border border-gray-200 rounded-md shadow-md w-32 z-10">
                  <button
                    (click)="startEditing(item)"
                    class="block w-full text-left px-4 py-2 hover:bg-gray-100 text-sm text-gray-700"
                  >
                    Modifier
                  </button>
                  <button
                    (click)="onDelete(item)"
                    class="block w-full text-left px-4 py-2 hover:bg-gray-100 text-sm text-gray-700"
                  >
                    Supprimer
                  </button>
                </div>
              }
            }
          </div>
        </div>
      }
    </div>
    } @else {
    <div class="bg-gray-100 rounded-md p-2 mb-2 text-center text-gray-500">
      Aucun résultat trouvé
    </div>
    }
  }
</div>


